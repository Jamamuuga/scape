<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html>
<head>
<title>Scape Programmer's Guide</title>
<style type="text/css">
</style>
</head>
<body>
<h1>Programmer's Guide - Scape</h1>
<p><b>Giliam de Carpentier</b><br>
<a href="http://www.decarpentier.nl/scape">http://www.decarpentier.nl/scape</a><br>
June 9th, 2012</p>

<h2>Build instructions for Microsoft Visual C++ 2008 (Express)</h2>
<p>Currently, Scape only comes with project and solution files for Microsoft Visual Studio C++ 2008 (Express). Follow the instructions below to build Scape's dependencies, to build Scape itself, and finally to run it.</p>
<ol>
 <li>Download and install a graphics driver and Microsoft DirectX 9.0, if not already done so<ul>
  <li>Install a recent graphics driver for your specific hardware</li>
  <li>Download and install the Microsoft DirectX 9.0c runtime from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=35">http://www.microsoft.com/en-us/download/details.aspx?id=35</a></li> 
 </ul></li>
 <li>Download and install the Microsoft C++ redistributables, if not already done so<ul>
  <li>Download and install the Microsoft Visual C++ 2008 Redistributable Package (x86) package from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=5582">http://www.microsoft.com/en-us/download/details.aspx?id=5582</a></li> 
 </ul></li>  
 <li>Extract Scape<ul>
   <li>Download the Scape source package, if not already done so. See <a href="http://www.decarpentier.nl/scape">http://www.decarpentier.nl/scape</a> for details on how to do this.</li>
   <li>Extract the ZIP to your preferred destination base folder, called <i>&lt;PROJECT&gt;</i> for the remainder of this document</li>
 </ul></li>
 <li>Install and build wxWidgets 2.8.3<ul>
   <li>Download <a href="http://sourceforge.net/projects/wxwindows/files/wxAll/2.8.3/wxWidgets-2.8.3.zip/download">http://sourceforge.net/projects/wxwindows/files/wxAll/2.8.3/wxWidgets-2.8.3.zip/download</a></li>
   <li>Extract the download to <i>&lt;PROJECT&gt;/Dependencies/</i></li>
   <li>Copy <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3-overwrite/lib</i> over the <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3/lib</i> folder</li>
   <li>Open <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3/build/msw/wx_dll.dsw</i> with Visual Studio 2008 (Express) and convert all projects</li>
   <li>Set the current configuration to <i>DLL Debug</i> and only build project <i>aui</i></li>
   <li>Set the current configuration to <i>DLL Release</i> and only build project <i>aui</i></li>
 </ul></li> 
 <li>Install and build wxPropertyGrid 1.2.12<ul>
   <li>Download <a href="http://sourceforge.net/projects/wxpropgrid/files/wxPropertyGrid/1.2.12/wxpropgrid-1.2.12-win.exe/download">http://sourceforge.net/projects/wxpropgrid/files/wxPropertyGrid/1.2.12/wxpropgrid-1.2.12-win.exe/download</a></li>
   <li>Start the installer and set the destination folder to <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3</i>.
       (don't worry about a potential windows compatibility warning when the installer is finished)</li>
   <li>Open <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3/contrib/build/propgrid/propgrid.dsw</i> with Visual Studio 2008 (Express) and convert project</li>
   <li>Set the current configuration to <i>DLL Debug</i> and build project <i>propgrid</i></li>
   <li>Set the current configuration to <i>DLL Release</i> and build project <i>propgrid</i></li>
   <li>Copy the following 8 built DLLs from <i>&lt;PROJECT&gt;/Dependencies/wxWidgets-2.8.3/lib/vc_dll/</i> to <i>&lt;PROJECT&gt;/Bin/</i> :
       <i>wxbase28_vc_custom.dll, wxmsw28_aui_vc_custom.dll, wxmsw28_core_vc_custom.dll, wxmsw28_propgrid_vc_custom.dll
	   wxbase28d_vc_custom.dll, wxmsw28d_aui_vc_custom.dll, wxmsw28d_core_vc_custom.dll and wxmsw28d_propgrid_vc_custom.dll</i>
	   (so, basically every DLL built in step 4 and 5 except for <i>wxmsw28(d)_adv_vc_custom.dll</i>)</li>
 </ul></li>
 <li>Install Ogre3D SDK 1.8.0<ul>
   <li>Download <a href="https://sourceforge.net/projects/ogre/files/ogre/1.8/1.8.0/OgreSDK_vc9_v1-8-0.exe/download">https://sourceforge.net/projects/ogre/files/ogre/1.8/1.8.0/OgreSDK_vc9_v1-8-0.exe/download</a></li>
   <li>Start the install and chooise any destination folder (for example, <i>&lt;PROJECT&gt;/Dependencies/OgreSDK</i>). The remainder of this document will call the chosen Ogre destination folder <i>&lt;OGRE_HOME&gt;</i>, after the environment variable <i>OGRE_HOME</i> that will be set automatically by the installer.</li>
   <li>Copy <i>OIS_d.dll, OgreMain_d.dll, Plugin_CgProgramManager_d.dll, Plugin_OctreeSceneManager_d.dll</i> and <i>RenderSystem_Direct3D9_d.dll</i> from <i>&lt;OGRE_HOME&gt;/bin/Debug/</i> to <i>&lt;PROJECT&gt;/Bin/</i></li>
   <li>Copy <i>cg.dll, OIS.dll, OgreMain.dll, Plugin_CgProgramManager.dll, Plugin_OctreeSceneManager.dll</i> and <i>RenderSystem_Direct3D9.dll</i> from <i>&lt;OGRE_HOME&gt;/bin/Release/</i> to <i>&lt;PROJECT&gt;/Bin/</i></li>
 </ul></li>
 <li>Build and Run Scape<ul>
   <li>Open <i>&lt;PROJECT&gt;/Scape.sln</i></li>
   <li>Set the current configuration to <i>Debug</i> and only build project <i>Editor</i></li>
   <li>Set the current configuration to <i>Release</i> and only build project <i>Editor</i></li>
   <li>For Debug: Run <i>&lt;PROJECT&gt;/Scape_d.exe</i>. For Release: Run <i>&lt;PROJECT&gt;/Scape.exe</i>. Alternatively, to run from within Visual Studio, set the 'working directory' under 'Debugging' in the 'Editor' project properties to <i>$(TargetDir)</i> and Run.</li>
 </ul></li>
 <li>OPTIONAL: Install Windows Sysinternals DebugView, displaying all (Ogre) log/debug output in real time when Scape is running<ul>
   <li>Download <a href="http://download.sysinternals.com/files/DebugView.zip">http://download.sysinternals.com/files/DebugView.zip</a></li>
   <li>Extract the files from <i>DebugView.zip</i> and run <i>DbgView.exe</i></li>
  </ul></li>
</ol>

<h2>C++ architecture</h2>
<p>The codebase is split into two major components: The Engine library and the Editor application. All UI-related code can be found in the Editor project. Everything else is in Engine. Each project is further grouped by functionality into subfolders. A description of the function of each source code file in these subfolders written in their header file.</p>
<ul>
 <li><i>/Editor</i> - GUI/wxWidgets-related code<ul>
  <li><i>/Application</i> - 'main' function and application class</li>
  <li><i>/Controls</i> - Custom drag / spinner wxWidget implemention</li>
  <li><i>/PCH</i> - Precompiled headers</li>
  <li><i>/Resources</i> - Icons</li>
  <li><i>/Utils</i> - Miscellaneous helper functions and classes</li>
  <li><i>/Windows</i> - GUI windows, dialogs and panels</li>
 </ul></li>
 <li><i>/Engine</i> - 2D/3D-related code<ul>
  <li><i>/EngineCore</i> - Management and control of world, sky and cameras, as well as (UI) properties and settings</li>
  <li><i>/GPU2DOperation</i> - 2D GPGPU bitmap / texture / rendertarget container and operation classes</li>
  <li><i>/HeightfieldBrush</i> - User-controlled brush widget</li>
  <li><i>/HeightfieldBuffer</i> - Heightfield / -set / -page data container</li>
  <li><i>/HeightfieldFileCodecs</i> - Heightfield import / export class interfaces and implementations</li>
  <li><i>/HeightfieldGeom</i> - Heightfield rendering</li>
  <li><i>/HeightfieldOperation</i> - Brush operation implementations</li>
  <li><i>/HeightfieldSerializer</i> - Heightfield serialization/compression</li>
  <li><i>/Input</i> - Mouse/Keyboard/Wacom mapping and handling</li>
  <li><i>/PCH</i> - Precompiled headers</li>
  <li><i>/Tinyxml</i> - XML parsing (third party)</li>
  <li><i>/Utils</i> - Math and miscellaneous functions and classes</li>
  <li><i>/Wintab</i> - Wacom driver headers</li>
 </ul></li>
</ul>

<h2>Materials and shaders</h2>
<p>The heightfield material is defined in /Bin/Materials/Scripts/HeightfieldMaterial.material. The Ogre materials for the GPU-based brushes are defined in /Bin/Materials/Scripts/GPU2DOperation.material. These materials refer to the following vertex and fragment shader code files in /Bin/Materials/Programs. </p>
<ul>
 <li><i>GPU2DOperation.cg</i> - The generic 1:1 vertex shader, and aimple 1:1 'copy' pixel shader</li>
 <li><i>GPU2DOperationAddMask.cg</i> - Experimental smoothing pixel shader</li>
 <li><i>GPU2DOperationNoiseDrag.cg</i> - Directional noise pixel shader</li>
 <li><i>GPU2DOperationNoiseMask.cg</i> - Procedural noise brush pixel shaders</li>
 <li><i>GPU2DOperationPencil.cg</i> - Smooth additive/subtractive brush pixel shader</li>
 <li><i>HeightfieldShaderCg.cg </i> - Heightfield terrain and brush widget rendering</li>
</ul>

<h2>Settings</h2>
<p>Many settings are store in the following config files in /Bin/Settings.</p>
<ul>
 <li><i>ButtonDefinitions.xml</i> - Mouse button and keyboard key to virtual 'buttons' (read)</li>
 <li><i>Perspective.cfg</i> - Current UI layout set by user (read/write)</li>
 <li><i>Presets.conf</i> - Tool presets set by user (read/write)</li>
 <li><i>Startup.conf</i> - Size of the heightfield to be loaded/saved/edited (read-only)</li>
 <li><i>UI.conf</i> - Names, descriptions and types of UI widgets and properties (read-only)</li>
</ul>

<h2>License</h2>
<p>See <i>/Docs/ScapeLicense.txt</i></p>
<p>Copyright (c) 2007-2012, Giliam de Carpentier. All rights reserved.</p>
</body>
</html>